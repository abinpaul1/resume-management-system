<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <link rel='stylesheet' href='/styles.css' />

    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
        integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">

    <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css" />
    <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
        integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo"
        crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"
        integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6"
        crossorigin="anonymous"></script>

    <title>Regsiter</title>


</head>

<body>
    <div class="container">
        <div class="row justify-content-center form-row">
            <div class="col-sm-12 col-md-8 col-lg-6">
                <div class="col-sm-12 form-legend">
                    <h2>Edit Employee</h2>
                </div>
                <div class="col-sm-12 form-column">
                    <form action="/api/candidate/update" id="reg_form" method="post">
                        <% if(success !=''){%>
                        <div class="alert alert-success">
                            <strong>Success!</strong> <%= success %>
                        </div>
                        <% } %>

                        <% if(error !=''){%>
                        <div class="alert alert-danger">
                            <strong>Error!</strong> <%= error %>
                        </div>
                        <% } %>

                        <input type="hidden" name="candidate_id" value="<%= records._id %>">

                        <!-- What is this for ?? -->
                        <div id="signupalert" style="display:none" class="alert alert-danger">
                            <p>Error:</p>
                            <span></span>
                        </div>
                        <!------->

                        <input type="hidden" name="date" class="form-control" value="<%= records.date %>">

                        <div class="form-group">
                            <label for="name">Name</label>
                            <input type="text" id="name" name="name" class="form-control" value="<%= records.name %>">
                        </div>

                        <div class="form-group">
                            <label for="email">Email</label>
                            <input type="text" id="email" name="email" class="form-control"
                                value="<%= records.email %>">
                        </div>

                        <div class="form-group">
                            <label for="position">Position</label>
                            <input type="text" id="position" name="position" class="form-control"
                                value="<%= records.position %>">
                        </div>
                        <div class="form-group">
                            <label for="experience">Experience</label>
                            <input type="text" id="experience" name="experience" class="form-control"
                                value="<%= records.experience %>">
                        </div>
                        <div class="form-group">
                            <label for="qualification">Qualification</label>
                            <input type="text" id="qualification" name="qualification" class="form-control"
                                value="<%= records.qualification %>">
                        </div>
                        <div class="form-group">
                            <label for="candidateRating">Candidate Rating</label>
                            <input type="text" id="candidateRating" name="candidateRating" class="form-control"
                                value="<%= records.candidateRating %>">
                        </div>
                        <div class="form-group">
                            <label for="salarys">Salary</label>
                            <input type="text" id="salary" name="salary" class="form-control"
                                value="<%= records.salary %>">
                        </div>
                        <div class="form-group">
                            <label for="phone">Phone</label>
                            <input type="text" id="phone" name="phone" class="form-control"
                                value="<%= records.phone %>">
                        </div>

                        <div class="form-group companies_input_fields_wrap">
                            <label for="companiesWorked">Companies Worked</label>

                            <div class="companies-entry">
                                <input type="text" name="companiesWorked" class="form-control">
                                <span>
                                  <button class="add_companies_button btn btn-success">
                                      <i class="fa fa-plus"></i>
                                  </button>
                                </span>
                            </div>
                            <% for (const company_row of records.companiesWorked){ %>
                            <div class="companies-entry">
                                <input type="text" name="companiesWorked" class="form-control" value="<%= company_row %>">
                                <span>
                                  <button class="remove_companies btn btn-danger">
                                    <i class="fa fa-minus"></i>
                                  </button>
                                </span>
                            </div>
                            <%}%>
                        </div>

                        <div class="form-group skills_input_fields_wrap">
                            <label for="skills">Skills</label>

                            <div class="skills-entry">
                                <input type="text" name="skills" class="form-control">
                                <span>
                                    <button class="add_skills_button btn btn-success">
                                        <i class="fa fa-plus"></i>
                                    </button>
                                </span>
                            </div>
                            <% for (const skill_row of records.skills){ %>
                            <div class="skills-entry">
                                <input type="text" name="skills" class="form-control" value="<%= skill_row %>">
                                <span>
                                    <button class="remove_skills btn btn-danger">
                                        <i class="fa fa-minus"></i>
                                    </button>
                                </span>
                            </div>
                            <%}%>
                        </div>

                        <div class="form-group">
                            <label for="interviewFeedback">Interview Feedback</label>
                            <input type="text" value="<%= records.interviewFeedback %>" id="interviewFeedback"
                                name="interviewFeedback" class="form-control">
                        </div>
                        <input type="submit" value="Register" class="btn btn-primary">
                    </form>
                </div>
            </div>
        </div>
        <script>
            $(document).ready(function () {


                const skillsAddDynamic = function () {
                    var skills_max_fields = 10; //maximum input boxes allowed
                    var skills_wrapper = $(".skills_input_fields_wrap"); //Fields wrapper
                    var skills_add_button = $(".add_skills_button"); //Add button ID
                    var x = $(".skills-entry").length+1; //initlal text box count
                    console.log(x)

                    $(skills_add_button).click(function (e) { //on add input button click
                        e.preventDefault();
                        if (x < skills_max_fields) { //max input box allowed
                            x++; //text box increment
                            $(skills_wrapper).append('<div class="skills-entry"><input type="text" class="form-control" name="skills"/><button class="remove_skills btn btn-danger"><i class="fa fa-minus"></i></button></div>');

                            $(skills_wrapper).find('input[type=text]:last').autocomplete({
                                source: function (req, res) {
                                    $.ajax({
                                        url: '/api/candidate/list/autocomplete/skills',
                                        dataType: 'jsonp',
                                        type: 'GET',
                                        data: req,
                                        success: function (data) {
                                            res(data);
                                            console.log("success entered");
                                        },
                                        error: function (err) {
                                            console.log(err.status);
                                            console.log("error entered");

                                        }
                                    });
                                },

                                minLength: 1,
                                select: function (event, ui) {
                                    if (ui.items) {
                                        $('#search-position').text(ui.item.label);
                                    }
                                }
                            });
                            //add input box
                        }
                    });

                    $(skills_wrapper).on("click", ".remove_skills", function (e) { //user click on remove text
                        //Changed parent("div") to parent().closest('div')
                        e.preventDefault(); $(this).parent().closest('div').remove(); x--;
                    })
                }

                const companiesAddDynamic = function () {
                    var companies_max_fields = 10; //maximum input boxes allowed
                    var companies_wrapper = $(".companies_input_fields_wrap"); //Fields wrapper
                    var companies_add_button = $(".add_companies_button"); //Add button ID
                    var x = $(".companies-entry").length+1; //initlal text box count


                    $(companies_add_button).click(function (e) { //on add input button click
                        e.preventDefault();
                        if (x < companies_max_fields) { //max input box allowed
                            x++; //text box increment
                            $(companies_wrapper).append('<div class="companies-entry"><input type="text" class="form-control" name="companiesWorked"/><button class="remove_companies btn btn-danger"><i class="fa fa-minus"></i></button></div>');

                            $(companies_wrapper).find('input[type=text]:last').autocomplete({
                                source: function (req, res) {
                                    $.ajax({
                                        url: '/api/candidate/list/autocomplete/skills',
                                        dataType: 'jsonp',
                                        type: 'GET',
                                        data: req,
                                        success: function (data) {
                                            res(data);
                                            console.log("success entered");
                                        },
                                        error: function (err) {
                                            console.log(err.status);
                                            console.log("error entered");

                                        }
                                    });
                                },

                                minLength: 1,
                                select: function (event, ui) {
                                    if (ui.items) {
                                        $('#search-position').text(ui.item.label);
                                    }
                                }
                            });
                            //add input box
                        }
                    });

                    $(companies_wrapper).on("click", ".remove_companies", function (e) { //user click on remove text
                        //Changed parent("div") to parent().closest('div')
                        e.preventDefault(); $(this).parent().closest('div').remove(); x--;
                    })
                }

                skillsAddDynamic();
                companiesAddDynamic();

                $("input[name^='skills']").autocomplete({
                    source: function (req, res) {
                        $.ajax({
                            url: '/api/candidate/list/autocomplete/skills',
                            dataType: 'jsonp',
                            type: 'GET',
                            data: req,
                            success: function (data) {
                                res(data);
                                console.log("success entered");
                            },
                            error: function (err) {
                                console.log(err.status);
                                console.log("error entered");

                            }
                        });
                    },

                    minLength: 1,
                    select: function (event, ui) {
                        if (ui.items) {
                            $('#search-position').text(ui.item.label);
                        }
                    }
                });

                // Position Autocomplete
                $('#position').autocomplete({
                    source: function (req, res) {
                        $.ajax({
                            url: '/api/candidate/list/autocomplete/position',
                            dataType: 'jsonp',
                            type: 'GET',
                            data: req,
                            success: function (data) {
                                res(data);

                            },
                            error: function (err) {
                                console.log(err.status);
                            }
                        });
                    },

                    minLength: 1,
                    select: function (event, ui) {
                        if (ui.items) {
                            $('#search-position').text(ui.item.label);
                        }
                    }
                });



                // Skills Autocomplete
                $('.skills').autocomplete({
                    source: function (req, res) {
                        $.ajax({
                            url: '/api/candidate/list/autocomplete/skills',
                            dataType: 'jsonp',
                            type: 'GET',
                            data: req,
                            success: function (data) {
                                res(data);
                                console.log("success entered");
                            },
                            error: function (err) {
                                console.log(err.status);
                                console.log("error entered");

                            }
                        });
                    },

                    minLength: 1,
                    select: function (event, ui) {
                        if (ui.items) {
                            $('#search-position').text(ui.item.label);
                        }
                    }
                });

            });
        </script>
</body>

</html>
